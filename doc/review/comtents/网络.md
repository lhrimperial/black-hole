## 网络

https://www.jianshu.com/p/0947b7b3c3c1

https://plantegg.github.io/2019/05/15/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E7%BD%91%E7%BB%9C--%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E5%8C%85%E7%9A%84%E6%97%85%E7%A8%8B/

#### 网络分层

1. OSI网络分层模型
   - 应用层
   - 表示层
   - 会话层
   - 传输层：
   - 网络层：封装IP逻辑地址
   - 数据链路层：封装数据帧，用MAC地址作为访问媒介
   - 物理层：实现比特流的透明传输
2. TCP/IP 网络分层模型
   - 应用层：负责实现一切与应用程序相关的功能
   - 传输层：负责提供可靠的传输服务
   - 网络层：负责网络间的寻址数据传输
   - 链路层：负责实际数据的传输

>端口：用来识别同一台计算机中不同的应用程序
>
>IP：用来识别网络中互联的主机和路由器
>
>MAC：用来识别同一链路中不同的计算机
>
>协议号：表明使用的是什么协议，区分使用的协议，如TCP为6



#### TCP 特性

1. 三次握手
2. 四次挥手

3. 通过序列号与确认应答提高可靠性

   序列号是按照顺序给发送数据都标上号码的编号。接收端查询接收数据 TCP 首部中的序列号和数据的长度，将自己下一步应该接收的序列号作为确认应答返送回去。通过序列号和确认应答号，TCP 能够识别是否已经接收数据，又能够判断是否需要接收，从而实现可靠传输。

4. 重发超时的确定

   重发超时是指在重发数据之前，等待确认应答到来的那个特定时间间隔。数据也不会被无限、反复地重发。达到一定重发次数之后，如果仍没有任何确认应答返回，就会判断为网络或对端主机发生了异常，强制关闭连接。并且通知应用通信异常强行终止。

5. 以段为单位发送数据

   MSS 在三次握手的时候，在两端主机之间被计算得出

6. 利用窗口控制提高速度

   窗口大小就是指无需等待确认应答而可以继续发送数据的最大值

7. 滑动窗口控制
8. 滑动窗口中的重发控制



> CLOSE_WAIT和TIME_WAIT
>
> - 常用的三个状态是：ESTABLISHED 表示正在通信，TIME_WAIT 表示主动关闭，CLOSE_WAIT 表示被动关闭。
> - close_wait 主要在TCP四次挥手时，服务端给客户端返回ACK应答后，由于自身还需要给客户端传输数据，所以会进入到close_wait状态，直到不需要给客户端发数据了，才会去给客户端发送FIN包，同时进入LAST_ACK状态。(被动关闭的一方没有及时发出 FIN 包就会导致自己一直处于close_wait状态。)
> - time_wait状态存在的意义是可以有效地终止TCP连接，因为主动关闭方发生ACK给被动关闭方后，需要等待2MSL的时间(MSL指的是报文最大有效存活时间，在linux下是60s)，在这个时间内，如果没有收到被动关闭方重发的FIN包，就说明连接关闭完成了。



#### IP特性

1. 概述：IPv4由32位正整数表示
2. IP地址由网络和主机两部分组成
3. IP地址分类
   - A类：从第 1 位到第 8 位是它的网络标识，0.0.0.0~127.0.0.0 是 A 类的网络地址，A 类地址的后 24 位相当于主机标识。因此，一个网段内可容纳的主机地址上限为16,777,214个。
   - B类：从第 1 位到第 16 位是它的网络标识。用十进制表示的话，128.0.0.0~191.255.0.0 是 B 类的网络地址。B 类地址的后 16 位相当于主机标识。因此，一个网段内可容纳的主机地址上限为65,534个。
   - C类：从第 1 位到第 24 位是它的网络标识。用十进制表示的话，192.0.0.0~223.255.255.0 是 C 类的网络地址。C 类地址的后 8 位相当于主机标识。因此，一个网段内可容纳的主机地址上限为254个。
   - D类：从第 1 位到第 32 位是它的网络标识。用十进制表示的话，224.0.0.0~239.255.255.255 是 D 类的网络地址。D 类地址没有主机标识，常用于多播。
4. 子网掩码：识别码通过子网网络地址识别出不同的网络，如172.20.100.0/26
5. 路由：IP 地址的网络地址部分用于进行路由控制，路由控制表中记录着网络地址（类似172.20.100.0/26）与下一步应该发送至路由器的地址。



#### 问题

1. 为什么要三次握手
  三次握手的目的是建立可靠的通信信道，说到通讯，简单来说就是数据的发送与接收，而三次握手最主要的目的就是双方确认自己与对方的发送与接收是正常的。

  - 第一次握手：Client 什么都不能确认；Server 确认了对方发送正常，自己接收正常
  - 第二次握手：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：对方发送正常，自己接收正常
  - 第三次握手：Client 确认了：自己发送、接收正常，对方发送、接收正常；Server 确认了：自己发送、接收正常，对方发送、接收正常

  所以三次握手就能确认双发收发功能都正常，缺一不可。

2. 第 2 次握手传回了 ACK，为什么还要传回 SYN？
  接收端传回发送端所发送的 ACK 是为了告诉客户端，我接收到的信息确实就是你所发送的信号了，这表明从客户端到服务端的通信是正常的。而回传 SYN 则是为了建立并确认从服务端到客户端的通信。”

  SYN 同步序列编号(Synchronize Sequence Numbers) 是 TCP/IP 建立连接时使用的握手信号。在客户机和服务器之间建立正常的 TCP 网络连接时，客户机首先发出一个 SYN 消息，服务器使用 SYN-ACK 应答表示接收到了这个消息，最后客户机再以 ACK(Acknowledgement）消息响应。这样在客户机和服务器之间才能建立起可靠的 TCP 连接，数据才可以在客户机和服务器之间传递。

3. 为什么要四次挥手
  断开一个 TCP 连接则需要“四次挥手”：

  - 客户端-发送一个 FIN，用来关闭客户端到服务器的数据传送

  - 服务器-收到这个 FIN，它发回一 个 ACK，确认序号为收到的序号加 1 。和 SYN 一样，一个 FIN 将占用一个序号

  - 服务器-关闭与客户端的连接，发送一个 FIN 给客户端

  - 客户端-发回 ACK 报文确认，并将确认序号设置为收到序号加 1

    

  任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送的时候，则发出连接释放通知，对方确认后就完全关闭了 TCP 连接。

4. 在浏览器中输入 url 地址 ->> 显示主页的过程
   1. DNS 解析
   2. TCP 连接
   3. 发送 HTTP 请求
   4. 服务器处理请求并返回 HTTP 报文
   5. 浏览器解析渲染页面
   6. 连接结束



##### 概念

1. 网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡，必定是先处理网络地址，然后再处理MAC地址。

2. 所谓"子网掩码"，就是表示子网络特征的一个参数。
3. IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。
4. ICMP 用于告知网络包传送过程中产生的错误以及各种控制信息。
5. ARP 用于根据 IP 地址查询相应的以太网 MAC 地址。
6. MTU 与 MSS
   - MTU：一个网络包的最大长度，以太网中一般为 1500 字节。
   - MSS：除去 IP 和 TCP 头部之后，一个网络包所能容纳的 TCP 数据的最大长度。



### 网络

> 一个数据包在网络中的旅程(https://segmentfault.com/a/1190000022037918)
>
> ping www.baidu.com
>
> 1. 解析url并生成http消息
>
> 2. 解析域名获取IP：本地DNS服务器--->根域（维护一级域及IP关系：.com - > ip）--->二级域--->IP
>
> 3. 将数据交给操作系统协议栈
>    - TCP和UDP负责收发数据，包装
>    - IP 协议控制网络包收发操作，IP 中还包括 ICMP 协议和 ARP 协议。
>      - ICMP 用于告知网络包传送过程中产生的错误以及各种控制信息。
>      - ARP 用于根据 IP 地址查询相应的以太网 MAC 地址。
>    - IP 下面的网卡驱动程序负责控制网卡硬件

<img src="/Users/eleme/Library/Application Support/typora-user-images/image-20210820120208611.png" alt="image-20210820120208611" style="zoom:50%;" />

#### TCP 可靠传输

<img src="/Users/eleme/Library/Application Support/typora-user-images/image-20210820112600881.png" alt="image-20210820112600881" style="zoom:50%;" />

1. 源端口号和目标端口号是不可少的，如果没有这两个端口号，数据就不知道应该发给哪个应用
2. 序列号，这个是为了解决包乱序的问题
3. 确认号，目的是确认发出去对方是否有收到。如果没有收到就应该重新发送，直到送达，这个是为了解决不丢包的问题。
4. 状态位，SYN 是发起一个连接，ACK 是回复，RST 是重新连接，FIN 是结束连接
5. 窗口大小，TCP 要做流量控制，通信双方各声明一个窗口（缓存大小），标识自己当前能够的处理能力



##### TCP 三次握手建立连接

- 一开始，客户端和服务端都处于 CLOSED 状态。先是服务端主动监听某个端口，处于 LISTEN 状态。
- 然后客户端主动发起连接 SYN，之后处于 SYN-SENT 状态。
- 服务端收到发起的连接，返回 SYN，并且 ACK 客户端的 SYN，之后处于 SYN-RCVD 状态。
- 客户端收到服务端发送的 SYN 和 ACK 之后，发送 ACK 的 ACK，之后处于ESTABLISHED 状态，因为它一发一收成功了。
- 服务端收到 ACK 的 ACK 之后，处于 ESTABLISHED 状态，因为它也一发一收了。



#### IP 远程定位

<img src="/Users/eleme/Library/Application Support/typora-user-images/image-20210820113334815.png" alt="image-20210820113334815" style="zoom:50%;" />

#### MAC 两点传输

生成了 IP 头部之后，接下来网络包还需要在 IP 头部的前面加上 MAC 头部。MAC 头部是以太网使用的头部，它包含了接收方和发送方的 MAC 地址等信息。

- **发送方**的 MAC 地址获取就比较简单了，MAC 地址是在网卡生产时写入到 ROM 里的，只要将这个值读取出来写入到 MAC 头部就可以了。
- 接收方MAC，通过ARP协议（广播的形式）找到路由器的MAC
  - ARP缓存，存放IP地址与MAC地址的关联信息
  - 如果存在将这个 MAC 地址写入 MAC 头部，MAC 头部就完成了
  - 不在缓存，发送 ARP报文，ARP request报文中包含源IP地址、目的IP地址、源MAC地址、目的MAC地址，其中目的MAC地址的值为0。ARP Request报文会在整个网络上传播，该网络中所有主机包括网关都会接收到此ARP request报文。网关将会阻止该报文发送到其他网络上。



#### 网卡 出口

负责将数字信号转换成电信号

#### 交换机 送别者

维护一张MAC地址与网线端口映射表



#### 路由器



> 路由器与交换机的区别
>
> - 因为路由器是基于 IP 设计的，俗称三层网络设备，路由器的各个端口都具有 MAC 地址和 IP 地址；
> - 而交换机是基于以太网设计的，俗称二层网络设备，交换机的端口不具有 MAC 地址。



#### Http 与Https

1. 为什么出现Https

 HTTP 天生明文传输的特性，在 HTTP 的传输过程中，任何人都有可能从中截获、修改或者伪造请求发送，所以可以认为 HTTP 是不安全的。

2. 什么是https

   HTTPS 的定义：**HTTPS 是一个在计算机世界里专门在两点之间安全的传输文字、图片、音频、视频等超文本数据的约定和规范**。 HTTPS 是 HTTP 协议的一种扩展，它本身并不保传输的证安全性，那么谁来保证安全性呢？在 HTTPS 中，使用`传输层安全性(TLS)`或`安全套接字层(SSL)`对通信协议进行加密。也就是 HTTP + SSL(TLS) = HTTPS。

3. HTTPS 做了什么
   HTTPS 协议提供了三个关键的指标

   - 加密(Encryption)， HTTPS 通过对数据加密来使其免受窃听者对数据的监听，这就意味着当用户在浏览网站时，没有人能够监听他和网站之间的信息交换，或者跟踪用户的活动，访问记录等，从而窃取用户信息。

   - 数据一致性(Data integrity)，数据在传输的过程中不会被窃听者所修改，用户发送的数据会完整的传输到服务端，保证用户发的是什么，服务器接收的就是什么。

   - 身份认证(Authentication)，是指确认对方的真实身份，也就是证明你是你（可以比作人脸识别），它可以防止中间人攻击并建立用户信任。

4. 加密
   - 对称加密(Symmetrical Encryption)顾名思义就是指加密和解密时使用的密钥都是同样的密钥。
   - 非对称加密(Asymmetrical Encryption) 也被称为公钥加密，相对于对称加密来说，非对称加密是一种新的改良加密方式。密钥通过网络传输交换，它能够确保及时密钥被拦截，也不会暴露数据信息。非对称加密中有两个密钥，一个是公钥，一个是私钥，公钥进行加密，私钥进行解密。公开密钥可供任何人使用，私钥只有你自己能够知道。
